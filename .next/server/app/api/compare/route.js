"use strict";(()=>{var e={};e.id=90,e.ids=[90],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1396:e=>{e.exports=require("undici")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},4242:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{POST:()=>l});var o=r(9303),n=r(8716),s=r(670),i=r(7070),c=r(1330);async function l(e){try{let{fund1_id:t,fund2_id:r}=await e.json();if(!t||!r)return i.NextResponse.json({error:"Missing fund IDs"},{status:400});let a=await (0,c.E)(t),o=await (0,c.E)(r),n=new Map(a.holdings.map(e=>[e.name,e.weight])),s=new Map(o.holdings.map(e=>[e.name,e.weight])),l=[...n.keys()].filter(e=>s.has(e)),p=0,u=l.map(e=>{let t=n.get(e),r=s.get(e),a=Math.min(t,r);return p+=a,{name:e,fund1_weight:t,fund2_weight:r,min_weight:Math.round(100*a)/100}});return u.sort((e,t)=>e.name.localeCompare(t.name)),i.NextResponse.json({success:!0,fund1:a,fund2:o,overlap:{percentage:Math.round(100*p)/100,common_stocks_count:l.length,stocks:u}})}catch(e){return console.error("Error in /api/compare:",e),i.NextResponse.json({success:!1,error:"Failed to compare funds"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/compare/route",pathname:"/api/compare",filename:"route",bundlePath:"app/api/compare/route"},resolvedPagePath:"/Users/yashakula/Documents/Projects/mf-analysis-tools/app/api/compare/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:m}=p,f="/api/compare/route";function h(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},1330:(e,t,r)=>{r.d(t,{c:()=>p,E:()=>u});var a=r(9909);let o=require("fs");var n=r.n(o),s=r(1017),i=r.n(s),c=r(1915);async function l(e){let t=process.env.BLOB_READ_WRITE_TOKEN;if(t)try{let{blobs:r}=await (0,a.pb)({prefix:`data/${e}`,token:t});if(r&&r.length>0){let e=r[0].url,t=await fetch(e);if(t.ok){let e=await t.text();return(0,c.Q)(e,{columns:!0,skip_empty_lines:!0})}}}catch(t){console.error(`Blob loading error for ${e}:`,t)}try{let t=i().join(process.cwd(),"data"),r=i().join(t,e),a=n().readFileSync(r,"utf-8");return(0,c.Q)(a,{columns:!0,skip_empty_lines:!0})}catch(t){return console.error(`Local file loading error for ${e}:`,t),[]}}async function p(){let e=process.env.BLOB_READ_WRITE_TOKEN;if(e)try{let{blobs:t}=await (0,a.pb)({prefix:"data/",token:e}),r=[];for(let e of t){let t=e.pathname;if(t.startsWith("data/")&&t.endsWith(".csv")){let e=t.replace("data/","").replace(".csv","");r.push({id:e,name:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())})}}return r}catch(e){console.error("Error listing funds from blob:",e)}try{let e=i().join(process.cwd(),"data");return n().readdirSync(e).filter(e=>e.endsWith(".csv")).map(e=>({id:e.replace(".csv",""),name:e.replace(".csv","").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}))}catch(e){return console.error("Error listing local files:",e),[]}}async function u(e){let t=`${e}.csv`;return function(e,t){if(!e||0===e.length)return{fund_name:t,holdings:[],total_stocks:0};let r=Object.keys(e[0]),a=r.includes("Company Name")?"Company Name":"Holding Name",o=r.includes("% Portfolio Weight")?"% Portfolio Weight":"% Portfolio",n=[];for(let t of e)try{let e=t[a]?.trim(),r=t[o];if(!e||!(r=String(r).replace("%","").trim()))continue;let s=parseFloat(r);n.push({name:e,weight:Math.round(100*s)/100})}catch(e){continue}return n.sort((e,t)=>e.name.localeCompare(t.name)),{fund_name:t,holdings:n,total_stocks:n.length}}(await l(t),e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,717],()=>r(4242));module.exports=a})();